{% for field_name, field in fields %}
    {% set field = prepare_form_field(field, field_name, name) %}
    {% if field %}
        {% set value = form ? form.value(field.name) : data.value(field.name) %}
        {% set field_templates = include_form_field(field.type, field_layout, 'text') %}

        {% block inner_markup_field_open %}{% endblock %}
        {% block field %}
            {% include field_templates %}
        {% endblock %}
        {% block inner_markup_field_close %}{% endblock %}
    {% endif %}
{% endfor %}
